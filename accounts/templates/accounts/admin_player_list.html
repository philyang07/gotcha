{% extends "base.html" %}

{% block content %}
{% if players %}
<h2>Player list</h2>
<table class="player_list">
    <tr>
        <th>Player</th>
        <th>Eliminations</th>
        <th>Time since last assignment</th>
        <th>Secret code</th>
        <th>Target</th>
        <th>Open</th>
        <th>Remove</th>
        <th>Manual open</th>
        <th>Manual kill</th>
    </tr>
    {% for player in players %}
    <tr class="{% if player.is_open == True %}is_open{% elif player.alive == False %}dead{% endif %}">
        <td>{{ player }}</td>
        <td>{{ player.kills }}</td>
        <td>{{ player.inactivity_duration }}</td>
        <td>{{ player.secret_code }}</td>
        <td>{{ player.target }}</td>
        <td>{% if player.is_open == True %}OPEN{% endif %}</td>
        <td>
            <form action="{% url 'accounts:delete_player' %}" method="POST">
                {% csrf_token %}
                <button type="submit">Delete</button>
                <input type="hidden" value="{{ player.pk }}" name="pk">
            </form>
        </td>
        {% if player.alive == True and player.last_active %}
        <td>
            <form action="{% url 'accounts:manual_open' %}" method="POST">
                {% csrf_token %}
                <button type="submit">{% if player.manual_open %}Undo{% else %}Set manual open{% endif %}</button>
                <input type="hidden" value="{{ player.pk }}" name="pk">
            </form>
        </td>
        <td>
            <form action="{% url 'accounts:manual_kill' %}" method="POST">
                {% csrf_token %}
                <button type="submit">{% if player.alive %}Manual kill{% else %}Eliminated{% endif %}</button>
                <input type="hidden" value="{{ player.pk }}" name="pk">
            </form>
        </td>
        {% endif %}
    </tr>
    {% endfor %}
</table>
{% if new_players %}
<h2>New players</h2>
<table>
    <tr>
        <th>Player</th>
        <th>Add to game</th>
    </tr>
    {% for player in new_players %}
    <tr>
        <td>{{ player }}</td>
        <td>
            <form action="{% url 'accounts:manual_add' %}" method="POST">
                {% csrf_token %}
                <button type="submit">Add</button>
                <input type="hidden" value="{{ player.pk }}" name="pk">
            </form>            
        </td>
    </tr>
    {% endfor %}
</table>
{% endif %}
<h2>Target ordering</h2>
<p>{{ target_ordering|linebreaks }}</p>
<form action="{% url 'accounts:reset_player_data' %}" method="POST">
    {% csrf_token %}
    <button type="submit">Reset player data</button>
</form>
<form action="{% url 'accounts:reassign_targets' %}" method="POST">
    {% csrf_token %}
    <button type="submit">Reassign targets</button>
</form>
{% else %}
<p>No players</p>
{% endif %}
<a href="{% url 'accounts:profile' %}">Go back</a>
{% endblock %}